{% extends "items/base.html" %}

{% block content %}
<div class="container my-5">
    <h2>Pedidos asignados a tu empresa</h2>
    <form method="get" class="mb-4">
        <label for="estado">Filtrar por estado:</label>
        <select name="estado" id="estado" class="form-select d-inline w-auto">
            <option value="">Todos</option>
            {% for value, label in estados %}
                <option value="{{ value }}" {% if estado == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-secondary btn-sm">Filtrar</button>
    </form>
    {% if pedidos %}
    <ul class="list-group list-group-light px-6 py-3">
        {% for pedido in pedidos %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
                <div class="fw-bold">Pedido #{{ pedido.id }} - {{ pedido.fecha_creacion|date:"d/m/Y H:i" }}</div>
                <div class="text-muted">Estado: {{ pedido.get_estado_display }}</div>
                <div>Cliente: {{ pedido.nombre_cliente }}</div>
                <div>Direcci√≥n: {{ pedido.direccion_envio }}</div>
            </div>
            <div>
                <ul>
                {% for item in pedido.pedidoitem_set.all %}
                    <li>{{ item.item.title }} x{{ item.cantidad }}</li>
                {% endfor %}
                </ul>
            </div>
            <form method="post" class="d-inline">
                {% csrf_token %}
                <input type="hidden" name="pedido_id" value="{{ pedido.id }}">
                <select name="nuevo_estado" class="form-select d-inline w-auto">
                    {% for value, label in estados %}
                        <option value="{{ value }}" {% if pedido.estado == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-primary btn-sm">Actualizar estado</button>
            </form>
            {% if pedido.recibo_pdf %}
            <a href="{% url 'items:pedido_recibo_pdf' pedido.id %}" target="_blank" class="btn btn-outline-success">Ver recibo PDF</a>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No tienes pedidos asignados actualmente.</p>
    {% endif %}
</div>
{% endblock content %}